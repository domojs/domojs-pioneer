{"version":3,"sources":["../index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["// ///<reference path='../../../devices/device.d.ts'/>\r\n\r\nimport * as $ from 'underscore';\r\nimport { domojs } from '../../../devices/device';\r\n\r\nexport namespace deviceTypes\r\n{\r\n    export class pioneer implements domojs.devices.DeviceType\r\n    {\r\n        public name = 'pioneer';\r\n\r\n        public onChange()\r\n        {\r\n            return 'dynamic';\r\n        }\r\n        public onAdd()\r\n        {\r\n        }\r\n\r\n        public onSave(data)\r\n        {\r\n        }\r\n\r\n        public onServerSave(device: domojs.devices.IDevice, body)\r\n        {\r\n            var send = require('./api').get;\r\n            var ptType: domojs.devices.IDevice = {\r\n                statusMethod: 'pull',\r\n                subdevices: [\r\n                    {\r\n                        name: \"power\",\r\n                        type: 'switch',\r\n                        statusMethod: 'pull',\r\n                        status: function (callback)\r\n                        {\r\n                            var status = {};\r\n                            send('?P', device.name, function (result)\r\n                            {\r\n                                console.log('result:' + result);\r\n                                if (result)\r\n                                    result = result.trim();\r\n                                callback({ state: result == 'PWR0', color: result == 'PWR0' ? 'green' : 'red' });\r\n                            });\r\n                        },\r\n                        commands:\r\n                        {\r\n                            on: '/api/pioneer/PO?device=' + device.name,\r\n                            off: '/api/pioneer/PF?device=' + device.name,\r\n                        }\r\n                    },\r\n                    {\r\n                        name: \"mute\",\r\n                        type: 'switch',\r\n                        category: 'actuator',\r\n                        statusMethod: 'pull',\r\n                        status: function (callback)\r\n                        {\r\n                            console.log('mute status');\r\n                            send('?M', device.name, function (result)\r\n                            {\r\n                                console.log(result);\r\n                                callback({ state: result == 'MUT0', color: result == 'MUT0' ? 'green' : 'red' });\r\n                            });\r\n                        },\r\n                        commands:\r\n                        {\r\n                            on: '/api/pioneer/MO?device=' + device.name,\r\n                            off: '/api/pioneer/MF?device=' + device.name,\r\n                        }\r\n                    },\r\n                    {\r\n                        name: \"volume\",\r\n                        type: 'analogic',\r\n                        category: 'actuator',\r\n                        statusMethod: 'pull',\r\n                        status: function (callback)\r\n                        {\r\n                            var status = {};\r\n                            send('?V', device.name, function (error, result)\r\n                            {\r\n                                callback({ state: Number(/\\d+/.exec(result)) * 100 / 185 });\r\n                            });\r\n                        },\r\n                        commands:\r\n                        {\r\n                            'up': '/api/pioneer/VU?device=' + device.name,\r\n                            'down': '/api/pioneer/VD?device=' + device.name,\r\n                            'set': '/api/pioneer/VL/{value}?device=' + device.name\r\n                        },\r\n                    },\r\n                    {\r\n                        name: \"input\",\r\n                        type: 'values',\r\n                        statusMethod: 'pull',\r\n                        status: function (callback)\r\n                        {\r\n                            send('?FN', device.name, function (result)\r\n                            {\r\n                                console.log(result);\r\n                                switch (Number(/[0-9]+/.exec(result)))\r\n                                {\r\n                                    case 49:\r\n                                        callback({ state: 'Game' });\r\n                                        break;\r\n                                    case 25:\r\n                                        callback({ state: 'BD' });\r\n                                        break;\r\n                                    case 4:\r\n                                        callback({ state: 'Dvd' });\r\n                                        break;\r\n                                    case 6:\r\n                                        callback({ state: 'Sat/Cbl' });\r\n                                        break;\r\n                                    case 15:\r\n                                        callback({ state: 'Dvr/Bdr' });\r\n                                        break;\r\n                                    case 17:\r\n                                        callback({ state: 'iPod' });\r\n                                        break;\r\n                                    case 10:\r\n                                        callback({ state: 'Video' });\r\n                                        break;\r\n                                    default:\r\n                                        callback(null);\r\n                                        break;\r\n                                }\r\n                            });\r\n                        },\r\n                        commands:\r\n                        {\r\n                            'Game': '/api/pioneer/49FN?device=' + device.name,\r\n                            'Dvd': '/api/pioneer/04FN?device=' + device.name,\r\n                            'Sat/Cbl': '/api/pioneer/06FN?device=' + device.name,\r\n                            'Dvr/Bdr': '/api/pioneer/15FN?device=' + device.name,\r\n                            'iPod': '/api/pioneer/17FN?device=' + device.name,\r\n                            'Video': '/api/pioneer/10FN?device=' + device.name,\r\n                            'BD': '/api/pioneer/25FN?device=' + device.name,\r\n                        },\r\n                    }\r\n                ],\r\n                status: function (callback)\r\n                {\r\n                    var status: { power?: { state: string, color?: string }, input?: { state: string, color?: string } } = {};\r\n                    var commands: $.Dictionary<domojs.devices.Command> = this.commands;\r\n                    send('?P', device.name, function (result)\r\n                    {\r\n                        status.power = { state: result, color: result == 'PWR0' ? 'green' : 'red' };\r\n                        send('?FN', device.name, function (result)\r\n                        {\r\n                            status.input = { state: result };\r\n                            $.each($.where(Object.keys(commands), function (value)\r\n                            {\r\n                                return value.indexOf('FN') > 0;\r\n                            }), function (index, value)\r\n                                {\r\n                                    status[index] = { state: index == result, color: result == index ? 'green' : 'red' };\r\n                                });\r\n                        })\r\n                    });\r\n                },\r\n                commands:\r\n                {\r\n                    'on': '/api/pioneer/PO?device=' + device.name,\r\n                    'off': '/api/pioneer/PF?device=' + device.name,\r\n                    'Game': '/api/pioneer/49FN?device=' + device.name,\r\n                    'Dvd': '/api/pioneer/04FN?device=' + device.name,\r\n                    'Sat/Cbl': '/api/pioneer/06FN?device=' + device.name,\r\n                    'Dvr/Bdr': '/api/pioneer/15FN?device=' + device.name,\r\n                    'iPod': '/api/pioneer/17FN?device=' + device.name,\r\n                    'BD': '/api/pioneer/25FN?device=' + device.name,\r\n                    'Volume Down': '/api/pioneer/VD?device=' + device.name,\r\n                    'Volume Up': '/api/pioneer/VU?device=' + device.name,\r\n                    'Mute On': '/api/pioneer/MO?device=' + device.name,\r\n                    'Mute Off': '/api/pioneer/MF?device=' + device.name,\r\n                }\r\n            };\r\n            var deviceToSave = $.extend({}, device);\r\n            deviceToSave.prototype = ptType;\r\n            $.extend(device, ptType);\r\n        }\r\n    }\r\n}"],"sourceRoot":"pioneer/src/server"}